language: python
python:
  - "3.9"

deploy:
  provider: heroku
  api_key:
    secure: "i7XD1hTb0RIC7HKdaU8YD74CXx0KCDbGHiWTGBwDU9fVAewLH+Mu60bkQSpvpBZX9zvM/uMtzQkoSJRJNObPHO4L3A43P72zQi1IFLfi+6JxD5EQo7oaMahuu3zbsF3sfbbaDVBnz5wQ2/jtx3RuzIFJ9ptcbxJ2DMIjthHx0Ws3g4KOyBYGySC1LQglFjm1uagGms8ba8V9DQei486llGCG+uZLJNlkdrcpa9DrVhQtFoFWOw6jdOmN2iEIQNLEBuQ8LHbfzVbCo8xlJPl7CIzql2M8wRCafbyTcBKvPLvGhG9p+J54dkcJQMHaXPtooHbMTAnmlpVXgNyrwyy47KtlGENDnygssgdEeDTXFNbL5P/bOvC8B4VH7CEolx8NlSCie8JsHUzEOb5YsKwQlusF+rgbbSp9sKf3WH1kkzuzLHZXLi7qYkk+3T3jcpCpFw+PicBdO1OswAvj17SXzZbumfmMAjr09yM5x504Oj9kMv05vlIizDeeZcan0Mcv7+Ue9z59bm1MD/kf80bGJuzVqMorK8agrFPsxnC8qsydyvEhWJVhAd9bcNrEvPhrNN2o9UwkXUzQW/M+vFEt2QchoFVVICRGGl+ULm+iQxEUDI5KrEiJPj7dEu3JcoRzji4dBxoBTt03lbvPV/YrpCvcWsbxSbP3Qync0O5gXwQ="
  on:
    branch: main

addons:
  sonarcloud:
    organization: "uzhase-fs21"
    token:
      secure: cP009y0D/ftpltXV0kL7w2X12YEgQzB9dEU5aoY/QSMRws9vHXXASY1bZ1b0sAE84SZpkUJBymxndCLwdtHPI9BRzOq2QPXlMNnfay3Z9iDyBbFtDQI7dEFi4WhPyjIj+rnj66WFABXNhJeDwkxbzIA/i0qsYzcA4tdbb82d1DaO1+X7QmNL2n5PWh7POnX7s9h3XGLqoeXv0mD59EPL28VIsWWkiN0Hk9LrSJC43ecWqJFwzEDDhLRoS3XzUpW64flUrPPUmn+5EVOCKzzhQoU5cGNsYf+hOjR1g4qyHVz8OTZeeoi1zEqCVDPMsmBey+hX7zsKNp5gHmZaKHD+jQtgkxyNOIG+KG8zFaLL5bTje8TrMfYj7GVc1qQ/6xUPOu53SV6Q93QAHPdKhpyyqL2Z6FMBSnlbbo8WAgAA6gY776loXv7R6HBr21By//wv/ozj4Oqal8GwGV1vM1w7+l1NFrA6hFsu8Z7q4NvJKskfXW0ueggU2OjU3TI0bWJfye7lkh6gZW2Ab2m8TvzKNm9MnzfKf6Req6uMHbC1yyzYd5Sf0fYcCpJQ5TSpXY9ZZhQhNnWh2VTe763bdzWNUjvaG0FGlnEjPiz8QNaqRVvTiUfXVUb6OtiDcWvJaRS7LYtMhO4tyhp7BiRRfuDGbTSK5VYy9eYkW9Ohm/3fg9c=
install:
  - pip install -r requirements.txt
  - pip install -r test-requirements.txt
script:
  # other script steps might be done before running the actual analysis
  - pytest --cov=server --rootdir=. && coverage xml # set rootdir because of relative path for SQLite connections
  - sonar-scanner

branches:
  only:
    - main
    - dev

notifications:
  email: false

env:
  global:
    - secure: SONAR_TOKEN=cP009y0D/ftpltXV0kL7w2X12YEgQzB9dEU5aoY/QSMRws9vHXXASY1bZ1b0sAE84SZpkUJBymxndCLwdtHPI9BRzOq2QPXlMNnfay3Z9iDyBbFtDQI7dEFi4WhPyjIj+rnj66WFABXNhJeDwkxbzIA/i0qsYzcA4tdbb82d1DaO1+X7QmNL2n5PWh7POnX7s9h3XGLqoeXv0mD59EPL28VIsWWkiN0Hk9LrSJC43ecWqJFwzEDDhLRoS3XzUpW64flUrPPUmn+5EVOCKzzhQoU5cGNsYf+hOjR1g4qyHVz8OTZeeoi1zEqCVDPMsmBey+hX7zsKNp5gHmZaKHD+jQtgkxyNOIG+KG8zFaLL5bTje8TrMfYj7GVc1qQ/6xUPOu53SV6Q93QAHPdKhpyyqL2Z6FMBSnlbbo8WAgAA6gY776loXv7R6HBr21By//wv/ozj4Oqal8GwGV1vM1w7+l1NFrA6hFsu8Z7q4NvJKskfXW0ueggU2OjU3TI0bWJfye7lkh6gZW2Ab2m8TvzKNm9MnzfKf6Req6uMHbC1yyzYd5Sf0fYcCpJQ5TSpXY9ZZhQhNnWh2VTe763bdzWNUjvaG0FGlnEjPiz8QNaqRVvTiUfXVUb6OtiDcWvJaRS7LYtMhO4tyhp7BiRRfuDGbTSK5VYy9eYkW9Ohm/3fg9c=