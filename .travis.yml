language: python
python:
  - "3.9"

deploy:
  provider: heroku
  api_key:
    secure: "bnXfhwSfE8QKvuZ/ZRe8k7AsvJUPuxRWS0B1Ua3glY0p/dk/Bq8l9lN46IvXO6RRvQW3TVPfKu+4fd+CW3DvjNkpcbvHP/YKYxU+yoounNBJR2Jk8Vdbnc1W5WO/wKn8kvTnOZEJT6kI3RvtGM7mNCNR0BjIeYcm3ULHyHFmiew168EhieYyKujtSvPTzMaIEuHEMEYrV5RtG6IcxzmB93zjLNx79gXu+aKXb1JPtDl7YLc0Ilkcr7a0wYHUHl00QtK5BtBk6zIOJH9vgZrEIonOIT8njzEhdQOMDvmruGCp4VATA8Zkn+jlqMWKOywRosaqEXZO4vfETPiym2VzHsMLU0p7p/fs3GPXQpuOe8MnM3/uNBSxRAR2J4FBRJnZuFxambmDqldIOXuCvrQXKAJXX01oFy2+xIZXgvyIaeHFC+6ajjetysibkb4Ze2q4+ZnewpfTTpBv/EEhF+uVojhJCM3hSFNx4Xe6gxyVGIhv1qXozSWVAj8TrAvJ81aQpe9w132G8rczPYUaPE0z8iAMkHT8td7nh+h6GJy6VDqvuxoXVkP2frx0k/PHayxqNnla62SROQr9EP2hUPcNkiYKBHcdCtMWxetsv74/+ATuYH+eML4cICrxyyd2tUxB7KZ7Ym4x2eqQtSOB483omll3Q6mE4RAuDI40GVHtRxU="
  on:
    branch: main

addons:
  sonarcloud:
    organization: "uzhase-fs21"
    token:
      secure: cP009y0D/ftpltXV0kL7w2X12YEgQzB9dEU5aoY/QSMRws9vHXXASY1bZ1b0sAE84SZpkUJBymxndCLwdtHPI9BRzOq2QPXlMNnfay3Z9iDyBbFtDQI7dEFi4WhPyjIj+rnj66WFABXNhJeDwkxbzIA/i0qsYzcA4tdbb82d1DaO1+X7QmNL2n5PWh7POnX7s9h3XGLqoeXv0mD59EPL28VIsWWkiN0Hk9LrSJC43ecWqJFwzEDDhLRoS3XzUpW64flUrPPUmn+5EVOCKzzhQoU5cGNsYf+hOjR1g4qyHVz8OTZeeoi1zEqCVDPMsmBey+hX7zsKNp5gHmZaKHD+jQtgkxyNOIG+KG8zFaLL5bTje8TrMfYj7GVc1qQ/6xUPOu53SV6Q93QAHPdKhpyyqL2Z6FMBSnlbbo8WAgAA6gY776loXv7R6HBr21By//wv/ozj4Oqal8GwGV1vM1w7+l1NFrA6hFsu8Z7q4NvJKskfXW0ueggU2OjU3TI0bWJfye7lkh6gZW2Ab2m8TvzKNm9MnzfKf6Req6uMHbC1yyzYd5Sf0fYcCpJQ5TSpXY9ZZhQhNnWh2VTe763bdzWNUjvaG0FGlnEjPiz8QNaqRVvTiUfXVUb6OtiDcWvJaRS7LYtMhO4tyhp7BiRRfuDGbTSK5VYy9eYkW9Ohm/3fg9c=
install:
  - pip install -r requirements.txt
  - pip install -r test-requirements.txt
script:
  # other script steps might be done before running the actual analysis
  - pytest --cov=server --rootdir=. && coverage xml # set rootdir because of relative path for SQLite connections
  - sonar-scanner
  - cd docs && sphinx-apidoc -o . ../ ../test && make html && cp /_build/html/* /_build/UZHASE.github.io/ && git add . && git commit -m"Update documentation" && git push origin master

branches:
  only:
    - main
    - dev

notifications:
  email: false

env:
  global:
    - secure: SONAR_TOKEN=cP009y0D/ftpltXV0kL7w2X12YEgQzB9dEU5aoY/QSMRws9vHXXASY1bZ1b0sAE84SZpkUJBymxndCLwdtHPI9BRzOq2QPXlMNnfay3Z9iDyBbFtDQI7dEFi4WhPyjIj+rnj66WFABXNhJeDwkxbzIA/i0qsYzcA4tdbb82d1DaO1+X7QmNL2n5PWh7POnX7s9h3XGLqoeXv0mD59EPL28VIsWWkiN0Hk9LrSJC43ecWqJFwzEDDhLRoS3XzUpW64flUrPPUmn+5EVOCKzzhQoU5cGNsYf+hOjR1g4qyHVz8OTZeeoi1zEqCVDPMsmBey+hX7zsKNp5gHmZaKHD+jQtgkxyNOIG+KG8zFaLL5bTje8TrMfYj7GVc1qQ/6xUPOu53SV6Q93QAHPdKhpyyqL2Z6FMBSnlbbo8WAgAA6gY776loXv7R6HBr21By//wv/ozj4Oqal8GwGV1vM1w7+l1NFrA6hFsu8Z7q4NvJKskfXW0ueggU2OjU3TI0bWJfye7lkh6gZW2Ab2m8TvzKNm9MnzfKf6Req6uMHbC1yyzYd5Sf0fYcCpJQ5TSpXY9ZZhQhNnWh2VTe763bdzWNUjvaG0FGlnEjPiz8QNaqRVvTiUfXVUb6OtiDcWvJaRS7LYtMhO4tyhp7BiRRfuDGbTSK5VYy9eYkW9Ohm/3fg9c=